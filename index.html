<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Estufa</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background: #f2f4f8;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .auth-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px 20px 40px;
        }

        .auth-box {
            width: 100%;
            max-width: 400px;
        }

        .auth-box h2 {
            margin-bottom: 25px;
            font-size: 26px;
        }

        input {
            width: 100%;
            padding: 14px;
            margin-bottom: 15px;
            border-radius: 12px;
            border: 1px solid #ddd;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: #007aff;
            color: white;
            font-size: 16px;
        }

        .switch {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
        }

        .switch span {
            color: #007aff;
            cursor: pointer;
        }

        .home {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            height: 60px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .profile-icon {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: #007aff;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
        }

        .logo {
            height: 130px;
            object-fit: contain;
        }

        .dropdown {
            position: absolute;
            top: 60px;
            right: 16px;
            width: 180px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }

        .dropdown div {
            padding: 12px;
            cursor: pointer;
        }

        .dropdown div:hover {
            background: #f5f5f5;
        }

        .content {
            flex: 1;
            padding: 20px;
        }

        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        .product-card img {
            width: 95%;
            height: 95%;
            object-fit: cover;
        }

        .product-card h3 {
            padding: 16px;
            font-size: 18px;
        }

        @media (max-width: 900px) {
            .auth-box {
                max-width: 520px;
            }

            .topbar {
                padding: 0 14px;
            }

            .content {
                padding: 16px;
            }
        }

        @media (max-width: 600px) {
            .topbar {
                height: 56px;
                padding: 0 12px;
            }

            .topbar h3 {
                font-size: 18px;
            }

            .profile-icon {
                width: 34px;
                height: 34px;
            }

            .auth-box {
                max-width: 460px;
            }

            .auth-box h2 {
                font-size: 22px;
            }

            input,
            button {
                padding: 12px;
                font-size: 15px;
            }

            .content {
                padding: 12px;
            }

            .dropdown {
                right: 8px;
                width: 160px;
                top: 56px;
            }

            .auth-container {
                justify-content: flex-start;
                padding-top: 28px;
            }
        }

        @media (max-width: 420px) {
            .auth-box {
                max-width: 360px;
                padding: 0 8px;
            }

            .auth-box h2 {
                font-size: 20px;
            }

            .dropdown {
                position: fixed;
                top: 56px;
                left: 0;
                right: 0;
                width: auto;
                border-radius: 0;
            }

            .switch {
                font-size: 13px;
            }
        }
    </style>
</head>

<body>

    <div id="app"></div>

    <script>
function abrirPerguntas() {
    document.querySelector(".content").innerHTML = `
        <div class="product-card">
            <h3 style="padding:20px;">Checklist da Estufa</h3>

            <div style="padding: 20px;">
                <p> A estufa está ligada corretamente?</p>
                <input type="text" placeholder="Resposta">

                <p> A temperatura está configurada corretamente?</p>
                <input type="text" placeholder="Resposta">

                <p> A porta está bem vedada?</p>
                <input type="text" placeholder="Resposta">

                <p> O tempo de operação foi ajustado?</p>
                <input type="text" placeholder="Resposta">

                <p> O equipamento está limpo?</p>
                <input type="text" placeholder="Resposta">

                <button style="margin-top:20px;" onclick="voltarHome()">Voltar</button>
            </div>
        </div>
    `;
}

function voltarHome() {
    location.reload();
}

function showLogin() {
    document.getElementById("app").innerHTML = `
<div class="auth-container">
  <div class="auth-box">

    <div style="text-align:center; margin-bottom:25px;">
      <img src="assets/logoInduslab.png" style="height:200px; object-fit:contain;">
    </div>

    <h2>Entrar</h2>

    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Senha">

    <button onclick="login()">Entrar</button>

    <div class="switch">
      Não tem conta? <span onclick="showRegister()">Criar conta</span>
    </div>

  </div>
</div>`;
}

function showRegister() {
    document.getElementById("app").innerHTML = `
<div class="auth-container">
  <div class="auth-box">
    <h2>Criar Conta</h2>
    <input type="text" id="nome" placeholder="Nome">
    <input type="text" id="sobrenome" placeholder="Sobrenome">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Senha">
    <input type="password" id="confirmPassword" placeholder="Confirmar Senha">
    <button onclick="register()">Criar</button>
    <div class="switch">
      Já tem conta? <span onclick="showLogin()">Entrar</span>
    </div>
  </div>
</div>`;
        }
function showHome(nomeCompleto, email) {
    const letra = nomeCompleto.charAt(0).toUpperCase();

    document.getElementById("app").innerHTML = `
<div class="home">
  <div class="topbar">
    <img src="assets/logoInduslab.png" class="logo">
    <div class="profile">
      <div class="profile-icon" onclick="toggleDropdown()">${letra}</div>
      <div class="dropdown" id="dropdown">
        <div>${nomeCompleto}</div>
        <div>${email}</div>
        <div onclick="logout()">Sair</div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="product-card" onclick="abrirPerguntas()">
      <img src="https://novatecnica.com.br/arquivos/produtos/imagens/capa/nt-532-estufa-de-secagem-e-esterilizacao-com-circulacao-forcada-41-litros.png">
      <h3>Estufa de secagem e esterilização com circulação</h3>
    </div>
  </div>
</div>`;
        }

function toggleDropdown() {
    const menu = document.getElementById("dropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
        }
    </script>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        import {
            getFirestore,
            doc,
            setDoc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDp0mwsh2URPYocVQcKI6her3-bdvImB-4",
            authDomain: "studio-6250006989-17aa1.firebaseapp.com",
            projectId: "studio-6250006989-17aa1",
            storageBucket: "studio-6250006989-17aa1.firebasestorage.app",
            messagingSenderId: "211228737318",
            appId: "1:211228737318:web:f5ac9de1405ba918c34be7"
        };

        const appFirebase = initializeApp(firebaseConfig);
        const auth = getAuth(appFirebase);
        const db = getFirestore(appFirebase);

        window.register = async function () {
            const nome = document.getElementById("nome").value;
            const sobrenome = document.getElementById("sobrenome").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);

                await setDoc(doc(db, "usuarios", userCredential.user.uid), {
                    nome: nome,
                    sobrenome: sobrenome,
                    nomeCompleto: nome + " " + sobrenome,
                    email: email,
                    criadoEm: new Date(),
                    ativo: true
                });
                alert("Conta criada com sucesso! Faça login.");

                await signOut(auth);
                showLogin();

            } catch (error) {
                alert(error.message);
            }
        };

        window.login = async function () {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch {
                alert("Email ou senha inválidos");
            }
        };

        window.logout = async function () {
            await signOut(auth);
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {

                const docRef = doc(db, "usuarios", user.uid);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const dados = docSnap.data();
                    showHome(dados.nome + " " + dados.sobrenome, dados.email);
                }

            } else {
                showLogin();
            }
        });

    </script>

</body>

</html>